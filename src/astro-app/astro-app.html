<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../astro-components/rux-button.html">
<link rel="import" href="../astro-components/rux-global-status-bar.html">
<link rel="import" href="../astro-components/rux-status.html">
<link rel="import" href="../astro-components/rux-icons-svg.html">
<link rel="import" href="../astro-components/rux-tabs.html">
<link rel="import" href="../astro-components/rux-icons-svg.html">
<link rel="import" href="../astro-components/rux-spectrum-analyzer.html">
<!-- <link rel="import" href="../astro-components/rux-advanced-status.html"> -->
<!-- <link rel="import" href="../astro-components/rux-icon-library.html">
<link rel="import" href="../astro-components/rux-icon.html"> -->
<dom-module id="astro-app">
  <template>
    <style>
     :host {
      display: block;
      /* box-sizing: border-box; */
    }
    /* :host:before,
      :host:after {
        box-sizing: border-box;
      }  */

    .rux-status-bar-group {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .rux-tool-bar-group {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      list-style: none;
      padding: 0;
      margin: 0;
      /* outline: 1px solid green; */
    }

    .rux-navigation-tabs ul {
      display: flex;
      list-style: none;
      outline: 1px solid blue;
    }
    </style>
    <rux-global-status-bar appname="Astro App" version="v1.022a">
      <!-- for tabbed navigation // -->
      <rux-tabs slot="tabs">
        <rux-tab id="tab-modems">Modems</rux-tab>
        <rux-tab id="tab-pass-plans">Pass Plans</rux-tab>
        <rux-tab id="tab-telemetry">Telemetry</rux-tab>
      </rux-tabs>
      <!-- status icons //-->
      <ul class="rux-status-bar-group" slot="status-bar">
        <li>
          <rux-status status="emergency" label="Netcom" sublabel="Ok" notifications="10" icon="advanced-status:netcom"></rux-status>
        </li>
        <li>
          <rux-status status="emergency" label="Advanced Status" notifications="1" sublabel="Error" icon="advanced-status:thermal"></rux-status>
        </li>
        <li>
          <rux-status status="standby" label="Standby" sublabel="Standby" notifications="100000" icon="advanced-status:propulsion-power"></rux-status>
        </li>
      </ul>
      </ul>
      <!-- toolbar items //-->
      <ul class="rux-tool-bar-group" slot="tool-bar">
        <li>
          <rux-button type="icon" icon="default:settings">Settings</rux-button>
        </li>
        <li>
          <rux-button type="icon" icon="default:notifications">Notifications</rux-button>
        </li>
        <li>
          <rux-user></rux-user>
        </li>
        <li>
          <rux-button type="large" icon="advanced-status:netcom">Master Off</rux-button>
        </li>
      </ul>
    </rux-global-status-bar>
    <rux-tab-panels>
      <rux-tab-panel aria-labeledby="tab-modems">
        <h1>Modems</h1>
        <rux-button>Cancel</rux-button>
        <rux-button on-click="graph" default>Ok</rux-button>
        <rux-button type="icon" icon="default:notifications">Notifications</rux-button>
        <rux-button type="icon" icon="default:settings">Settings</rux-button>
        <rux-button icon="advanced-status:netcom">Master Off</rux-button>
      </rux-tab-panel>
      <rux-tab-panel aria-labeledby="tab-pass-plans">
        <h1>Pass Plans</h1>
        <rux-clock></rux-clock>
      </rux-tab-panel>
      <rux-tab-panel aria-labeledby="tab-telemetry">
        <h1>Telemetry</h1>
        <h2>Spectrum Analyzer</h2>
        <!--  -->
        <rux-spectrum-analysis chart-data="[[chartData]]" chart-legend-x="Frequency (mHz)" chart-legend-y="Power (dBm)" x-scale-min=9 00 x-scale-max=2 350 x-scale-step=5 0 y-scale-min=- 30 y-scale-max=0 height="250" width="480"> </rux-spectrum-analysis>
      </rux-tab-panel>
    </rux-tab-panels>
  </template>
  <script>
  /**
   * @customElement
   * @polymer
   */
  class AstroApp extends Polymer.Element {
    static get is() { return 'astro-app'; }
    static get properties() {
      return {
        prop1: {
          type: String,
          value: 'astro-app'
        }
      };
    }
    constructor() {
      super();
      // This should probably exist in a separate component outside of
      // astro-app and outside of rux-spectrum-analysis
      const ws = new WebSocket('ws://dev-dv.rocketcom.com:40510');
      ws.addEventListener('message', (event) => {
        // assign the data to a property on the rux-spectrum-analysis component
        this.chartData = this._dataToJsonObjArray(event.data);
      });
    }
    ready() {
      super.ready();
    }
    // This should probably exist in a separate component outside of
    // astro-app and outside of rux-spectrum-analysis
    _dataToJsonObjArray(data) {
      let dataArray = data.split('|');
      let scrubbedArray = [];
      dataArray.shift(); // data comes with an extra pipe in the front
      for (let c = 0; c < dataArray.length; c++) {
        let datum = dataArray[c];
        let datumArray = datum.split(':');
        let d = {};
        d.frequency = datumArray[0];
        d.power = datumArray[1];
        d.value = parseInt(datumArray[0]);
        scrubbedArray.push(d);
      }
      return scrubbedArray;
    }
  }
  window.customElements.define(AstroApp.is, AstroApp);
  </script>
</dom-module>