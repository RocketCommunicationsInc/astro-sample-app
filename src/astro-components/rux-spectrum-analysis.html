<link rel="import" href="/bower_components/polymer/polymer.html">
<script src="//d3js.org/d3.v3.js"></script>


<dom-module id="rux-spectrum-analysis">
  <template>
    <style>
      :host {
        border: 1px solid red;
        height: 200px;
        width: 100vw;
        display: block;

        contain: content;
      }

      #chart-container {
        outline: 1px solid green;
        height: 100px;
        width: 100%;
      }

      .bar {
        fill: orange;
      }

      .bar:hover {
        fill: steelblue;
      }

      .axis text {
        font: 10px sans-serif;
      }

      .axis path,
      .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }

      .x.axis path {
        display: none;
      }

      .test {
        border: 1px solid red;
      }
    </style>

    <div id="chart-container">Chart</div>
    <svg id="chart" class="chart" height$="[[height]]" width$="[[width]]">

    </svg>
    

  </template>

  <script>
    class RuxSpectrumAnalysis extends Polymer.Element {
      static get is() { return 'rux-spectrum-analysis'; }
      static get properties() {
        return {
          chartData: {
            type: Object,
            observer: '_dataChanged'
          },
          height: {
            type: Number
          },
          width: {
            type: Number
          },
          scale: {
            type: Array
          }
        }
      }

    constructor() {
      super();
      console.log('RuxSpectrumAnalysis in da house!');
      console.log(this);
    }



    connectedCallback() {
      super.connectedCallback();

      this._chart = this._registerChart();
      

      let margin = {top: 20, right: 30, bottom: 30, left: 40}
      let width = 960 - margin.left - margin.right
      let height = 500 - margin.top - margin.bottom;

      var xScale = d3.scale.ordinal()
        .rangeRoundBands([0, width], .1);
      this.xscale = xScale;

      var yScale = d3.scale.linear()
        .range([height, 0]);
      this.yscale = yScale;

      var xAxis = d3.svg.axis()
        .scale(xScale)
        .orient("bottom");

      var yAxis = d3.svg.axis()
        .scale(yScale)
        .orient("left")
        .ticks(10, "%");
        
      
        var svg = d3.select(this.root.querySelector('svg'))
                // .append("svg")
                // .attr("width", width + margin.left + margin.right)
                // .attr("height", height + margin.top + margin.bottom)
                // .attr("class", "chart");
        
        // let svg = this.root.querySelector('svg');
        console.log('svg',svg);

        var chart = svg.append("g")
                .attr('class','graph')
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

          xScale.domain([900, 950, 1000, 1050, 1100, 1150, 1200, 1250, 1300, 1350, 1400, 1450, 1500, 1550, 1600, 1650, 1700, 1750, 1800, 1850, 1900, 1950, 2000, 2000, 2050, 2100, 2150, 2200, 2250, 2300]);
          yScale.domain([-.3,0]);

          chart.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);

          chart.append("g")
            .attr("class", "y axis")
            .call(yAxis);


        console.log(this.root.querySelector('.graph'));
      

      // const abscissa = document.createElement('g')
      //       abscissa.setAttribute('transform',`translate(0,${height}`);
      //       abscissa.classList.add('x,axis');
      //       chart.call(xAxis);

      // const ordinate = document.createElement('g');
      //       ordinate.classList.add('y,axis');
      //       chart.call(yAxis);
      //     // ordinate.call(yAxis);


      
            // chart.appendChild(abscissa);
            // chart.appendChild(ordinate);
      

      // const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      //       svg.setAttribute('width', width + margin.left + margin.right);
      //       svg.setAttribute('height',height + margin.top + margin.bottom);
      //       svg.classList.add('chart');
      
      // this._chart.appendChild(svg);

      // const chart = svg.append('g')
      //       chart.setAttribute('transform',`translate(${margin.left},${margin.top})`);

      // console.log('svg',svg);

     

      

            // chart.append('g')
            //   .attr('class','x axis')
            //   .attr('transform',`translate(0,${height}`)
            //   .call(xAxis);
            // chart.append('g')
            //   .attt('class','y axis')
            //   .call(yAxis);
      
      
      
      // console.log(this._chart);
      

      
      
      
    }

    disconnectedCallback() {
      super.disconnectedCallback();
    }

    ready() {
      super.ready();
      
      // this._draw();
    }


    _registerChart() {
      console.log('register chart');
      //let test = document;
      return this.root.querySelector('#chart-container');
    }

    _dataChanged() {
      // console.log('data changed');
      //// console.log(this.chartData);
      // this._clear();
      //console.log('chart',this.querySelectorAll('div'));

      this._clear();
      this._draw();
    }
 

    _update() {
      //console.log('update',this._chart);
      
    }

    _clear() {
      let graph = d3.select(this.root.querySelector('.graph'));
          graph.selectAll('.bar').remove();
      // this._chart.selectAll('.bar').remove();
      // console.log(this._chart);
    }

    _draw() {
      
      // this._chart = this._registerChart();
      // console.log('this chart data == ',this._chart);
      
      let graph = d3.select(this.root.querySelector('.graph'));
      let result = this.chartData;
      // console.log('chart',bob);

      this.chartData.forEach(function(data) {
        console.log(data);
        graph.selectAll('.bar')
          .data(result)
          .enter()
          .append('rect')
            .attr('class','bar')
            .attr('x',      (data) => { return data.frequency; })
            .attr('y',      (data) => { return data.power; })
            .attr('height', (data) => { return 100 - data.power; })
            .attr('width', 10);
      })

      // return;
      // for ( let c = 0; c < result.length; c++ ) {
      //   let d = result[c];
      //   bob.selectAllChildren(".bar")
      //     .data(result)
      //     .enter()
      //     .append("rect")
      //   .attr("class", "bar")
      //   .attr("x", function(d) { return xScale(d.frequency); })
      //   .attr("y", function(d) { return yScale(d.power); })
      //   .attr("height", function(d) { return height - yScale(d.power); })
      //   .attr("width", xScale.rangeBand());
      // }
    }

       
  }

    customElements.define(RuxSpectrumAnalysis.is, RuxSpectrumAnalysis);

  </script>
  
</dom-module>
