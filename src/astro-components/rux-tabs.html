<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href="rux-tab.html">
<link rel="import" href="rux-tab-panels.html">
<link rel="import" href="rux-tab-panel.html">

<dom-module id="rux-tabs">
	<template>
		<style>
			:host {
					margin: 0;
					padding: 0;
					display: flex;
					align-self: flex-start;
					contain: content; /* This improves CSS performance see: https://developers.google.com/web/updates/2016/06/css-containment */
				}

			
				

			</style>

			
			<slot></slot>

	</template>

	<script>
		class RuxTabs extends Polymer.Element {
				
				static get is() { return 'rux-tabs'; }
				static get properties() {
					return {
						type: String,
						tabGroup: String,
						tabs: {
							type: Object,
							notify: true,
							observer: '_tabChanged'
						},
						panels: {
							type: Object,
							notify: true,
							observer: '_panelChanged'
						}
					}
				}

				constructor() {
        	super();

					this._updateTabListener = this._setTab.bind(this);
					this._registerPanelsListener = this._registerPanels.bind(this);
					

					
				}


				connectedCallback() {
					super.connectedCallback();

					this._tabs = this._registerTabs();
					this._panels = null;

					window.addEventListener('set-tab', this._updateTabListener);
					window.addEventListener('register-panels', this._registerPanelsListener);
				}

				disconnectedCallback() {
					super.disconnectedCallback();
					window.removeEventListener('set-tab', this._updateTabListener);
					window.removeEventListener('register-panels', this._registerPanelsListener);
				}




				_tabChanged(e) {
					console.log('tab changed',e);
				}
				
				_panelChanged(e) {
					console.log('panel changed',e);
				}
				

				ready() {
					super.ready();
				}


				_registerTabs() {
					return this.querySelectorAll('rux-tab');
				}

				/*
				**
				** Register associated panels
				**
				*/
				_registerPanels(e) {
					this._panels = e.detail.panels;
				}


				_setTab(e) {

					let _tab = e.detail.tab;
					
					this._tabs.forEach(function(tab) {
						tab.selected = false;
					})
					_tab.selected = true;
					

					this._panels
						.forEach(function(panel) {
							panel.hidden = true;

							if(panel.getAttribute('aria-labeledby') === _tab.getAttribute('id')) {
								panel.hidden = false;
							}
					});
					

					// this._panels[1].removeAttribute('hidden')
					// console.log('panel',this._panels[1]);
					// console.log('panel',this._panels[1]);
					// console.log('panel type',typeof(this._panels[1]));
					// console.log('panel.id',this._panels[1].getAttribute('id'))
					// this._panels[1].setAttribute('id','batman');
					// this._panels[1].removeAttribute('hidden');
					// console.log('panel',this._panels[1]);
					// this._panels[1].addAttribute('hidden');
					// console.log('panels',this._panels[1])
					
				}
		}

		customElements.define(RuxTabs.is, RuxTabs);
	</script>
</dom-module>